{% extends "base.html" %}
{% load static %}

{% block title %}Criar Oportunidade{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/criar_oportunidade.css' %}">
{% endblock %}

{% block content %}
<div class="opportunity-page">
    <header class="opportunity-header">
        {# O botão de voltar deve ter uma ação JS ou uma URL #}
        <a href="#" class="opportunity-back-button" onclick="history.back(); return false;">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                <path d="M15 6L9 12L15 18" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </a>

        <div class="opportunity-header-title">Criar Oportunidade</div>
        <div class="opportunity-header-subtitle">Conecte alunos com oportunidades acadêmicas criadas por você</div>
    </header>

    <form method="POST" enctype="multipart/form-data" class="opportunity-form">
        {% csrf_token %} 
        
        <div class="opportunity-container">
            
            {# Campo escondido que o Django Forms precisa para 'tipo' #}
            <input type="hidden" name="{{ form.tipo.name }}" id="{{ form.tipo.id_for_label }}" value="">

            {# ------------------ 1. TIPO DE OPORTUNIDADE (Botões) ------------------ #}
            <div class="form-group opportunity-type-group">
                <label class="opportunity-label">Tipo de atividade <span class="required">*</span></label>
                
                <div class="opportunity-activity-group">
                     {# Os valores de data-value devem coincidir com os choices do seu forms.py #}
                     <button type="button" class="opportunity-activity-btn" data-value="MON">Monitoria Acadêmica</button>
                     <button type="button" class="opportunity-activity-btn" data-value="IC">Iniciação Científica</button>
                     <button type="button" class="opportunity-activity-btn" data-value="EST">Estágio</button>
                     <button type="button" class="opportunity-activity-btn" data-value="LP">Laboratório de Pesquisa</button>
                     <button type="button" class="opportunity-activity-btn" data-value="TMP">Trabalho Meio Período</button>
                     <button type="button" class="opportunity-activity-btn" data-value="VOL">Voluntariado</button>
                     <button type="button" class="opportunity-activity-btn" data-value="PAL">Palestra</button>
                     <button type="button" class="opportunity-activity-btn" data-value="EQC">Equipe de Competição</button>
                     <button type="button" class="opportunity-activity-btn" data-value="BOL">Bolsa</button>
                     <button type="button" class="opportunity-activity-btn" data-value="OUT">Outro</button>
                
                </div>
                {# Mensagem de erro para o campo tipo #}
                {% for error in form.tipo.errors %}<span class="error-message">{{ error }}</span>{% endfor %}
            </div>
            
            {# ------------------ 2. TÍTULO E DESCRIÇÃO ------------------ #}
            <div class="form-group">
                <label class="opportunity-label" for="{{ form.titulo.id_for_label }}">Título <span class="required">*</span></label>
                {{ form.titulo }} 
                {% for error in form.titulo.errors %}<span class="error-message">{{ error }}</span>{% endfor %}
                <span class="char-counter">0/100</span>
            </div>

            <div class="form-group">
                <label class="opportunity-label" for="{{ form.descricao.id_for_label }}">Descrição <span class="required">*</span></label>
                {{ form.descricao }}
                {% for error in form.descricao.errors %}<span class="error-message">{{ error }}</span>{% endfor %}
                <span class="char-counter">0/5000</span>
            </div>

            {# ------------------ 3. IMAGEM DE CAPA ------------------ #}
            <div class="form-group">
                <label class="opportunity-label" for="{{ form.foto.id_for_label }}">Imagem de Capa (Opcional)</label>
                {{ form.foto }}
                {% for error in form.foto.errors %}<span class="error-message">{{ error }}</span>{% endfor %}
                <small class="opportunity-help-text">Se nenhuma imagem for enviada, um placeholder será exibido.</small>
            </div>

            {# ------------------ 4. OUTROS CAMPOS DE INPUT ------------------ #}
            {% for field in form %}
                {% if field.name != 'tipo' and field.name != 'titulo' and field.name != 'descricao' and field.name != 'foto' and field.name != 'data_encerramento' %}
                    <div class="form-group">
                        <label class="opportunity-label" for="{{ field.id_for_label }}">{{ field.label }} {% if field.field.required %}<span class="required">*</span>{% endif %}</label>
                        {{ field }}
                        {% for error in field.errors %}<span class="error-message">{{ error }}</span>{% endfor %}
                    </div>
                {% endif %}
            {% endfor %}
            
            {# ------------------ 5. DATA DE ENCERRAMENTO (Fim do Form) ------------------ #}
            <div class="form-group">
                <label class="opportunity-label" for="{{ form.data_encerramento.id_for_label }}">Data de encerramento do processo seletivo <span class="required">*</span></label>
                {{ form.data_encerramento }}
                {% for error in form.data_encerramento.errors %}<span class="error-message">{{ error }}</span>{% endfor %}
            </div>
            
            <button type="submit" class="opportunity-confirm">Confirmar</button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const typeHiddenInput = document.getElementById('id_tipo');
        const activityGroup = document.querySelector('.opportunity-activity-group');
        const buttons = activityGroup ? activityGroup.querySelectorAll('.opportunity-activity-btn') : [];

        // Lógica visual e de valor para selecionar o botão
        buttons.forEach(btn => {
            btn.addEventListener('click', () => {
                buttons.forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                
                // Define o valor do input hidden com base no data-value do botão
                typeHiddenInput.value = btn.getAttribute('data-value');
            });
        });

        // Adiciona a lógica de JavaScript para os contadores de caracteres
        const charCounterSetup = (textareaId, counterClass, maxLength) => {
            const textarea = document.getElementById(textareaId);
            const counter = textarea ? textarea.closest('.form-group').querySelector(counterClass) : null;

            if (textarea && counter) {
                const updateCounter = () => {
                    counter.textContent = `${textarea.value.length}/${maxLength}`;
                };
                textarea.addEventListener('input', updateCounter);
                updateCounter(); // Contagem inicial
            }
        };

        // Aplica o contador para Título e Descrição
        charCounterSetup('id_titulo', '.char-counter', 100);
        charCounterSetup('id_descricao', '.char-counter', 5000);
    });
</script>
{% endblock %}