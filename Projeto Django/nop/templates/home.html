{% extends 'base.html' %}
{% load static %}

{% block title %}Home | NOP{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/home_style.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
    /* Ajuste para tornar o slide clicável sem quebrar o layout */
    .carousel-link {
        text-decoration: none;
        color: inherit;
        display: block;
        cursor: pointer;
    }
    
    /* Garante que a imagem do carrossel tenha um tamanho fixo e corte elegante */
    .carousel-item img {
        height: 600px; /* Você pode ajustar essa altura conforme necessário */
        object-fit: cover;
        filter: brightness(0.7); /* Escurece levemente para o texto ficar legível */
    }

    .carousel-caption {
        background: rgba(0, 0, 0, 0.5); /* Fundo semitransparente para leitura */
        border-radius: 10px;
        padding: 20px;
    }
</style>
{% endblock %}

{% block content %}
<section class="hero-banner">
    <div class="hero-content">
        <h1 class="main-message">Todas as portas abertas da PUC reunidas em um só lugar</h1>
        <p class="secondary-message">Não perca nada: todas as oportunidades aqui.</p>
    </div>
</section>

<main class="main-content">
    <section class="carousel-wrapper">
        
        {% if destaques %}
        <div id="opportunityCarousel" class="carousel slide" data-bs-ride="carousel">
            
            <div class="carousel-indicators">
                {% for vaga in destaques %}
                <button type="button" 
                        data-bs-target="#opportunityCarousel" 
                        data-bs-slide-to="{{ forloop.counter0 }}" 
                        class="{% if forloop.first %}active{% endif %}" 
                        aria-current="{% if forloop.first %}true{% endif %}" 
                        aria-label="Slide {{ forloop.counter }}">
                </button>
                {% endfor %}
            </div>

            <div class="carousel-inner">
                {% for vaga in destaques %}
                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                    
                    <a href="{% if user.is_authenticated %}{% url 'detalhe_oportunidade' vaga.id %}{% else %}{% url 'login' %}?next={% url 'detalhe_oportunidade' vaga.id %}{% endif %}" class="carousel-link">
                        
                        {% if vaga.foto %}
                            <img src="{{ vaga.foto.url }}" alt="{{ vaga.titulo }}" class="d-block w-100">
                        {% else %}
                            <img src="{% static 'img/placeholder_img.png' %}" alt="Sem imagem" class="d-block w-100">
                        {% endif %}

                        <div class="carousel-caption d-none d-md-block">
                            <h5>{{ vaga.titulo }}</h5>
                            <p>{{ vaga.descricao|truncatewords:20 }}</p>
                            
                            <span class="btn btn-sm btn-outline-light mt-2">
                                {% if user.is_authenticated %}Ver Detalhes{% else %}Faça Login para Ver{% endif %}
                            </span>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>

            <button class="carousel-control-prev" type="button" data-bs-target="#opportunityCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"><i class="fa-solid fa-angle-left"></i></span>
            </button>
            
            <button class="carousel-control-next" type="button" data-bs-target="#opportunityCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"><i class="fa-solid fa-angle-right"></i></span>
            </button>
        </div>
        {% else %}
            <div style="text-align: center; padding: 40px; background: #f8f9fa; border-radius: 8px;">
                <h3>Ainda não há oportunidades em destaque.</h3>
            </div>
        {% endif %}

    </section>
</main>

<section class="course-filter-section">
    <div class="filter-box">
        <h2 class="filter-title">Ache oportunidades do meu curso</h2>
        <p class="filter-description">Conectamos você às oportunidades mais relevantes do seu curso para que sua trajetória universitária seja ainda mais completa e significativa</p>
        
        <form class="filter-form" action="{% url 'feed' %}" method="GET">
            <label for="course-select" class="sr-only">Selecione o seu Curso</label>
            <div class="select-wrapper">
                <select id="course-select" name="curso_selecionado" required>
                    <option value="" disabled selected>Selecione o seu Curso</option>
                    
                    {% for curso in cursos %}
                        <option value="{{ curso.id }}">{{ curso.nome }}</option>
                    {% endfor %}
                    
                </select>
            </div>
            
            <button type="submit" class="ir-btn">IR</button>
        </form>
    </div>
</section>

<footer class="main-footer"></footer>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("search");
    if (searchInput) {
        const clearButton = document.getElementById("clear-btn");
    }
});
</script>
{% endblock %}