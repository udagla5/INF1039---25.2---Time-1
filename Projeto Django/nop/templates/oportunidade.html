{% extends 'base.html' %}
{% load static %}

{% block title %}{{ oportunidade.titulo }} | NOP{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/oportunidade.css' %}" />
{% endblock %}

{% block content %}
<div class="op-detail-page">
    
    <header class="op-detail-header">
        <a href="javascript:history.back()" class="op-back-btn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
        </a>
        <h1 class="op-title">{{ oportunidade.titulo }}</h1>
        <div class="op-badges">
            <span class="badge badge-tipo">{{ oportunidade.get_tipo_display }}</span>
            <span class="badge badge-local">{{ oportunidade.local }}</span>
        </div>
    </header>

    <main class="op-container">
        <div class="op-grid-info">
            <div class="info-card">
                <span class="label">Carga Hor√°ria</span>
                <span class="value">{{ oportunidade.carga_horaria }}</span>
            </div>
            <div class="info-card">
                <span class="label">Remunera√ß√£o</span>
                <span class="value">R$ {{ oportunidade.remuneracao }}</span>
            </div>
            <div class="info-card">
                <span class="label">Vagas</span>
                <span class="value">{{ oportunidade.num_vagas }}</span>
            </div>
            <div class="info-card">
                <span class="label">Horas Comp.</span>
                <span class="value">{{ oportunidade.horas_complementares }}h</span>
            </div>
            <div class="info-card">
                <span class="label">Encerramento</span>
                <span class="value">{{ oportunidade.data_encerramento|date:"d/m/Y" }}</span>
            </div>
        </div>

        <hr class="op-divider">

        <section class="op-section">
            <h2>Sobre a Oportunidade</h2>
            <div class="op-text-content">
                {{ oportunidade.descricao|linebreaks }}
            </div>
        </section>

        <section class="op-section">
            <h2>Processo Seletivo</h2>
            <div class="op-text-content">
                {{ oportunidade.processo_seletivo|linebreaks }}
            </div>
        </section>

        <section class="op-section">
            <h2>Cursos Eleg√≠veis</h2>
            <p class="op-text-highlight">{{ oportunidade.cursos_elegiveis }}</p>
        </section>

        <div class="op-actions">
            <button class="btn-candidatar">Candidatar-se</button>
            
            {% with id_oportunidade=oportunidade.id %}
                {% if id_oportunidade %}
                    <form method="post" action="{% url 'favoritar_oportunidade' id_oportunidade %}" id="fav-form-detalhe" style="display:none;">
                        {% csrf_token %}
                        <button type="submit"></button> 
                    </form>
                    
                    <a href="#" id="btn-favoritar-detalhe" 
                       class="btn-salvar-link btn-salvar-detalhe {% if oportunidade.id in favoritos_ids %}favorito{% endif %}" 
                       title="Salvar Oportunidade">
                        <svg class="heart-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                        </svg>
                    </a>
                {% endif %}
            {% endwith %}
        </div>

    </main>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // üöÄ NOVO SCRIPT PARA SALVAR VIA LINK (DETALHE)
    document.addEventListener('DOMContentLoaded', function() {
        const salvarLink = document.getElementById('btn-favoritar-detalhe');
        const favoritoForm = document.getElementById('fav-form-detalhe');
        
        if (salvarLink && favoritoForm) {
            salvarLink.addEventListener('click', function(e) {
                e.preventDefault(); // Impede o link de navegar (ir para #)
                favoritoForm.submit(); // Envia o formul√°rio
            });
        }
    });
</script>
{% endblock %}