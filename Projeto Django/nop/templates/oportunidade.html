{% extends 'base.html' %}
{% load static %}

{% block title %}{{ oportunidade.titulo }} | NOP{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/oportunidade.css' %}" />
{% endblock %}

{% block content %}
<div class="op-detail-page">
    
    <header class="op-detail-header">
        <a href="javascript:history.back()" class="op-back-btn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
        </a>
        <h1 class="op-title">{{ oportunidade.titulo }}</h1>
        <div class="op-badges">
            <span class="badge badge-tipo">{{ oportunidade.get_tipo_display }}</span>
            <span class="badge badge-local">{{ oportunidade.local }}</span>
        </div>
    </header>

    <main class="op-container">
        
        <div class="header-oportunidade-grid" style="display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 30px;">
            
            <div style="background: #031020; padding: 15px; border-radius: 8px; flex: 1; min-width: 140px; text-align: center; color: white;">
                <div style="font-size: 11px; font-weight: 600; color: #a0a0a0; margin-bottom: 5px; text-transform: uppercase;">CARGA HORÁRIA</div>
                <div style="font-size: 16px; font-weight: 700;">{{ oportunidade.carga_horaria }}</div>
            </div>

            <div style="background: #031020; padding: 15px; border-radius: 8px; flex: 1; min-width: 140px; text-align: center; color: white;">
                <div style="font-size: 11px; font-weight: 600; color: #a0a0a0; margin-bottom: 5px; text-transform: uppercase;">REMUNERAÇÃO</div>
                <div style="font-size: 16px; font-weight: 700;">
                    {% if oportunidade.remuneracao > 0 %}
                        R$ {{ oportunidade.remuneracao }}
                    {% else %}
                        Voluntário
                    {% endif %}
                </div>
            </div>

            <div style="background: #031020; padding: 15px; border-radius: 8px; flex: 1; min-width: 100px; text-align: center; color: white;">
                <div style="font-size: 11px; font-weight: 600; color: #a0a0a0; margin-bottom: 5px; text-transform: uppercase;">VAGAS</div>
                <div style="font-size: 16px; font-weight: 700;">{{ oportunidade.num_vagas }}</div>
            </div>

            <div style="background: #031020; padding: 15px; border-radius: 8px; flex: 1; min-width: 140px; text-align: center; color: white;">
                <div style="font-size: 11px; font-weight: 600; color: #a0a0a0; margin-bottom: 5px; text-transform: uppercase;">HORAS COMP.</div>
                <div style="font-size: 16px; font-weight: 700;">{{ oportunidade.horas_complementares }}h</div>
            </div>

            <div style="background: #031020; padding: 15px; border-radius: 8px; flex: 1; min-width: 140px; text-align: center; color: white;">
                <div style="font-size: 11px; font-weight: 600; color: #a0a0a0; margin-bottom: 5px; text-transform: uppercase;">ENCERRAMENTO</div>
                <div style="font-size: 16px; font-weight: 700;">
                    {% if oportunidade.data_encerramento %}
                        {{ oportunidade.data_encerramento|date:"d/m/Y" }}
                    {% else %}
                        Indefinido
                    {% endif %}
                </div>
            </div>

        </div>
        <hr class="op-divider">

        <section class="op-section">
            <h2>Sobre a Oportunidade</h2>
            <div class="op-text-content">
                {{ oportunidade.descricao|linebreaks }}
            </div>
        </section>

        {% if oportunidade.processo_seletivo %}
        <section class="op-section">
            <h2>Processo Seletivo</h2>
            <div class="op-text-content">
                {{ oportunidade.processo_seletivo|linebreaks }}
            </div>
        </section>
        {% endif %}

        {% if oportunidade.cursos_elegiveis %}
        <section class="op-section">
            <h2>Cursos Elegíveis</h2>
            <p class="op-text-highlight">{{ oportunidade.cursos_elegiveis }}</p>
        </section>
        {% endif %}

        <div class="op-actions">
            <button class="btn-candidatar">Candidatar-se</button>
            
            {% with id_oportunidade=oportunidade.id %}
                {% if id_oportunidade %}
                    <form method="post" action="{% url 'favoritar_oportunidade' id_oportunidade %}" id="fav-form-detalhe" style="display:none;">
                        {% csrf_token %}
                        <button type="submit"></button> 
                    </form>
                    
                    <a href="#" id="btn-favoritar-detalhe" 
                       class="btn-salvar-link btn-salvar-detalhe {% if oportunidade.id in favoritos_ids %}favorito{% endif %}" 
                       title="Salvar Oportunidade">
                        <svg class="heart-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                        </svg>
                    </a>
                {% endif %}
            {% endwith %}
        </div>

    </main>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // SCRIPT PARA SALVAR VIA LINK (DETALHE)
    document.addEventListener('DOMContentLoaded', function() {
        const salvarLink = document.getElementById('btn-favoritar-detalhe');
        const favoritoForm = document.getElementById('fav-form-detalhe');
        
        if (salvarLink && favoritoForm) {
            salvarLink.addEventListener('click', function(e) {
                e.preventDefault(); // Impede o link de navegar (ir para #)
                favoritoForm.submit(); // Envia o formulário
            });
        }
    });
</script>
{% endblock %}