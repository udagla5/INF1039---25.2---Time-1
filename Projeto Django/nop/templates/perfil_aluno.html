{% extends "base.html" %}
{% load static %}

{% block title %}Editar Perfil | NOP{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/perfil_aluno_style.css' %}">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
    /* Reset específico para evitar conflitos com o header do base.css */
    .profile-edit-container .profile-avatar,
    .profile-edit-container .edit-avatar-btn {
        width: auto !important;
        height: auto !important;
        border-radius: 0 !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="profile-edit-container">
    <header class="profile-edit-header">
        <div class="profile-header-content">
            <div class="profile-header-text">
                <h1>Editar Perfil</h1>
                <p>Configure a sua experiência NOP</p>
            </div>
        </div>
    </header>

    <main class="profile-edit-main">
        <div class="profile-avatar-section">
            <div class="profile-avatar-large">
                {% if user.profile.avatar %}
                    <img src="{{ user.profile.avatar.url }}" alt="Foto de perfil" class="profile-avatar-img">
                {% elif user.avatar %}
                    <img src="{{ user.avatar.url }}" alt="Foto de perfil" class="profile-avatar-img">
                {% else %}
                    <div class="profile-default-avatar">
                        {{ user.get_full_name|default:user.username|first|upper }}
                    </div>
                {% endif %}
                <button class="profile-edit-avatar-btn" aria-label="Editar Foto de Perfil">
                    <i class="fa-solid fa-camera"></i>
                </button>
            </div>
        </div>

        <div class="profile-edit-form-box">
            <form class="profile-edit-form" method="POST">
                {% csrf_token %}
                
                <!-- Seção 1: Informações Pessoais -->
                <div class="profile-form-section">
                    <h3 class="profile-section-title">Informações Pessoais</h3>
                    
                    <div class="profile-form-group">
                        <label for="username">Seu username</label>
                        <input type="text" id="username" name="username" value="{{ user.username }}">
                    </div>

                    <div class="profile-form-group">
                        <label for="email-institucional">Email institucional</label>
                        <input type="email" id="email-institucional" name="email-institucional" value="{{ user.email }}">
                    </div>

                    <div class="profile-form-group">
                        <label for="email-secundario">Email institucional secundário</label>
                        <input type="email" id="email-secundario" name="email-secundario" placeholder="seu.nome@aluno.puc-rio.br">
                    </div>

                    <div class="profile-form-group">
                        <label for="telefone">Telefone</label>
                        <input 
                            type="tel" 
                            id="telefone" 
                            name="telefone" 
                            placeholder="(21) 99999-9999"
                            pattern="(\([0-9]{2}\)\s)?[0-9]{4,5}-[0-9]{4}"
                            maxlength="15"
                            onkeypress="return isNumberKey(event)"
                            onkeyup="formatPhone(this)">
                    </div>
                </div>

                <!-- Separador visual -->
                <div class="profile-section-divider"></div>

                <!-- Seção 2: Segurança -->
                <div class="profile-form-section">
                    <h3 class="profile-section-title">Segurança</h3>
                    
                    <div class="profile-form-group profile-password-group">
                        <label for="senhaAntigaInput">Senha atual</label>
                        <input type="password" id="senhaAntigaInput" name="senha-antiga" placeholder="Digite a sua senha atual">
                        <button type="button" class="profile-toggle-password-btn" id="toggleSenhaAntiga">
                            <i class="fa-solid fa-eye-slash"></i>
                        </button>
                    </div>

                    <div class="profile-form-group profile-password-group">
                        <label for="senhaNovaInput">Nova senha</label>
                        <input type="password" id="senhaNovaInput" name="senha-nova" placeholder="Digite a sua nova senha">
                        <button type="button" class="profile-toggle-password-btn" id="toggleSenhaNova">
                            <i class="fa-solid fa-eye-slash"></i>
                        </button>
                    </div>
                </div>

                <!-- Separador visual -->
                <div class="profile-section-divider"></div>

                <!-- Seção 3: Interesses -->
                <div class="profile-form-section">
                    <h3 class="profile-section-title">Interesses</h3>
                    <p class="profile-section-description">Selecione os seus interesses</p>
                        
                    <div class="profile-interests-grid">
                        <button type="button" class="profile-interest-tag">Design Gráfico</button>
                        <button type="button" class="profile-interest-tag">Programação</button>
                        <button type="button" class="profile-interest-tag">Sustentabilidade</button>
                        <button type="button" class="profile-interest-tag">Inteligência Artificial</button>
                        <button type="button" class="profile-interest-tag">Mercado Financeiro</button>
                        <button type="button" class="profile-interest-tag">Comunicação</button>
                        <button type="button" class="profile-interest-tag">UX/UI</button>
                        <button type="button" class="profile-interest-tag">Engenharia de Software</button>
                        <button type="button" class="profile-interest-tag">Biologia Marinha</button>
                        <button type="button" class="profile-interest-tag">Análise de Dados</button>
                        <button type="button" class="profile-interest-tag">Marketing</button>
                        <button type="button" class="profile-interest-tag">Artes Cênicas</button>
                        <button type="button" class="profile-interest-tag">Gestão de Projetos</button>
                        <button type="button" class="profile-interest-tag">Línguas</button>
                    </div>
                </div>

                <button type="submit" class="profile-confirm-btn">Confirmar mudanças</button>
            </form>
        </div>
    </main>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function formatPhone(input) {
        let value = input.value.replace(/\D/g, "");
        let formattedValue = '';

        if (value.length > 0) formattedValue = '(' + value.substring(0, 2);
        if (value.length > 2) formattedValue += ') ' + value.substring(2, 7);
        if (value.length > 7) formattedValue += '-' + value.substring(7, 11);
        
        input.value = formattedValue.substring(0, 15);
    }

    function isNumberKey(evt) {
        const c = evt.which ? evt.which : evt.keyCode;
        return !(c > 31 && (c < 48 || c > 57));
    }

    function setupPasswordToggle(toggleId, inputId) {
        const toggleButton = document.getElementById(toggleId);
        const passwordInput = document.getElementById(inputId);

        toggleButton.addEventListener('click', function() {
            const type = passwordInput.type === 'password' ? 'text' : 'password';
            passwordInput.type = type;

            const icon = this.querySelector('i');
            icon.classList.toggle('fa-eye');
            icon.classList.toggle('fa-eye-slash');
        });
    }

    // Configurar toggles de senha
    setupPasswordToggle('toggleSenhaAntiga', 'senhaAntigaInput');
    setupPasswordToggle('toggleSenhaNova', 'senhaNovaInput');

    // Configurar tags de interesse
    document.querySelectorAll('.profile-interest-tag').forEach(button => {
        button.addEventListener('click', function() {
            this.classList.toggle('profile-interest-selected');
        });
    });
</script>
{% endblock %}